<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 Edg/143.0.0.0" version="29.2.9">
  <diagram name="Page-1" id="2YBvvXClWsGukQMizWep">
    <mxGraphModel dx="1037" dy="616" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-12" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=16;fontStyle=1" value="Diagrama de Secuencia - Flujo de Mensaje Trackfy" vertex="1">
          <mxGeometry height="30" width="400" x="320" y="10" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-13" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" value="App Flutter" vertex="1">
          <mxGeometry height="40" width="100" y="60" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-14" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="50" y="100" as="sourcePoint" />
            <mxPoint x="50" y="870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-15" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" value="API Gateway&#xa;(Go + Fiber)" vertex="1">
          <mxGeometry height="40" width="100" x="200" y="60" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-16" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="250" y="100" as="sourcePoint" />
            <mxPoint x="250" y="870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-17" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" value="Fy-Engine&#xa;(Go)" vertex="1">
          <mxGeometry height="40" width="100" x="400" y="60" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-18" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="450" y="100" as="sourcePoint" />
            <mxPoint x="450" y="870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-19" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" value="Fy-Analysis&#xa;(Go)" vertex="1">
          <mxGeometry height="40" width="100" x="600" y="60" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-20" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="650" y="100" as="sourcePoint" />
            <mxPoint x="650" y="870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-21" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" value="API LLM&lt;br&gt;(GPT)" vertex="1">
          <mxGeometry height="40" width="100" x="800" y="60" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-22" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="850" y="100" as="sourcePoint" />
            <mxPoint x="850" y="870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-23" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="50" y="140" as="sourcePoint" />
            <mxPoint x="250" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-24" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="1. POST /chat/message (JWT + mensaje)" vertex="1">
          <mxGeometry height="20" width="200" x="60" y="120" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-25" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="250" y="170" as="sourcePoint" />
            <mxPoint x="450" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-26" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="2. HTTP POST /process (user_id, mensaje)" vertex="1">
          <mxGeometry height="20" width="200" x="260" y="150" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-27" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#000000;" value="" vertex="1">
          <mxGeometry height="50" width="10" x="445" y="175" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-28" parent="1" style="text;html=1;strokeColor=#000000;fillColor=#ffffff;align=left;verticalAlign=middle;rounded=0;fontSize=10" value="3. Clasificar intención&#xa;   - Regex: URL, email, telefono&#xa;   - Detectar tipo de consulta" vertex="1">
          <mxGeometry height="50" width="170" x="465" y="175" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-29" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;dashed=0;" value="" vertex="1">
          <mxGeometry height="380" width="860" x="20" y="240" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-30" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=10;fontStyle=1" value="alt" vertex="1">
          <mxGeometry height="20" width="30" x="25" y="243" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-31" parent="1" style="text;html=1;strokeColor=none;fillColor=#e0e0e0;align=left;verticalAlign=middle;rounded=0;fontSize=10;fontStyle=2" value="[Contiene URL / Email / Teléfono - Requiere análisis]" vertex="1">
          <mxGeometry height="20" width="280" x="60" y="243" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-32" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="280" as="sourcePoint" />
            <mxPoint x="650" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-33" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="4. HTTP POST /analyze&#xa;{type, value, context}" vertex="1">
          <mxGeometry height="30" width="140" x="478" y="251" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-34" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#000000;" value="" vertex="1">
          <mxGeometry height="120" width="10" x="645" y="285" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-35" parent="1" style="text;html=1;strokeColor=#000000;fillColor=#ffffff;align=left;verticalAlign=middle;rounded=0;fontSize=10" value="5. Pipeline de análisis:&#xa;   - Normalizar entrada&#xa;   - Consultar cache Redis&#xa;   - Query DB local + APIs&#xa;   - Correlación heurística&#xa;   - Calcular score (0-100)" vertex="1">
          <mxGeometry height="90" width="160" x="665" y="285" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-36" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="650" y="420" as="sourcePoint" />
            <mxPoint x="450" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-37" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="6. ThreatResult {score, level, threats[], reasons[]}" vertex="1">
          <mxGeometry height="20" width="200" x="465" y="400" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-38" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="460" as="sourcePoint" />
            <mxPoint x="850" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-39" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="7. Generar respuesta empática con resultado de análisis" vertex="1">
          <mxGeometry height="20" width="280" x="520" y="440" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-40" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="850" y="500" as="sourcePoint" />
            <mxPoint x="450" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-41" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="8. Respuesta Fy: &quot;¡Cuidado! Este enlace...&quot;" vertex="1">
          <mxGeometry height="20" width="250" x="540" y="480" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-42" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=8 8;strokeWidth=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="20" y="530" as="sourcePoint" />
            <mxPoint x="880" y="530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-43" parent="1" style="text;html=1;strokeColor=none;fillColor=#e0e0e0;align=left;verticalAlign=middle;rounded=0;fontSize=10;fontStyle=2" value="[Mensaje normal - No requiere análisis]" vertex="1">
          <mxGeometry height="20" width="220" x="60" y="535" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-44" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="570" as="sourcePoint" />
            <mxPoint x="850" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-45" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="9. Generar respuesta conversacional (sin análisis)" vertex="1">
          <mxGeometry height="20" width="260" x="530" y="550" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-46" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="850" y="600" as="sourcePoint" />
            <mxPoint x="450" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-47" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="10. Respuesta Fy conversacional" vertex="1">
          <mxGeometry height="20" width="180" x="570" y="580" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-48" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="670" as="sourcePoint" />
            <mxPoint x="250" y="670" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-49" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="11. {response, analysis?, fy_mood}" vertex="1">
          <mxGeometry height="20" width="180" x="270" y="650" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-50" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="250" y="710" as="sourcePoint" />
            <mxPoint x="50" y="710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-51" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10" value="12. 200 OK - JSON Response" vertex="1">
          <mxGeometry height="20" width="160" x="80" y="690" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-52" parent="1" style="text;html=1;strokeColor=#000000;fillColor=#ffffff;align=left;verticalAlign=top;rounded=0;fontSize=10;spacingLeft=5;spacingTop=5" value="Notas:&#xa;- Comunicación entre microservicios: HTTP REST&#xa;- Clasificación por Regex en Fy-Engine&#xa;- Fy-Analysis solo se invoca si hay URL/Email/Teléfono&#xa;- LLM siempre genera la respuesta final con personalidad Fy" vertex="1">
          <mxGeometry height="80" width="320" x="20" y="750" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-53" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;" value="" vertex="1">
          <mxGeometry height="80" width="250" x="420" y="750" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-54" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=10;fontStyle=1" value="Leyenda" vertex="1">
          <mxGeometry height="15" width="50" x="430" y="755" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-55" edge="1" parent="1" style="endArrow=block;html=1;strokeWidth=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="430" y="785" as="sourcePoint" />
            <mxPoint x="490" y="785" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-56" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=9" value="Request síncrono" vertex="1">
          <mxGeometry height="15" width="90" x="500" y="777" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-57" edge="1" parent="1" style="endArrow=block;html=1;strokeWidth=1;dashed=1;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="430" y="805" as="sourcePoint" />
            <mxPoint x="490" y="805" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-58" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=9" value="Response" vertex="1">
          <mxGeometry height="15" width="90" x="500" y="797" as="geometry" />
        </mxCell>
        <mxCell id="Zwmuh-DhoYUzPTEY1YZG-59" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=9" value="alt = Flujo condicional" vertex="1">
          <mxGeometry height="15" width="120" x="430" y="815" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
